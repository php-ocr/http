on:
    - push
    - pull_request
    - release

jobs:

    analyze:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - run: composer install
            - run: composer require php-http/multipart-stream-builder
            - run: pipelines/analyze/phpstan
            - run: pipelines/analyze/psalm
            # Fails due to some autoloading issue.
            # - run: pipelines/analyze/phan

    lint:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - run: composer install
            - run: composer require php-http/multipart-stream-builder
            - run: pipelines/lint/code-sniffer
            - run: pipelines/lint/code-style-fixer
            - run: pipelines/lint/copy-paste-detector

    test:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - run: composer install
            - run: composer require php-http/multipart-stream-builder
            - run: pipelines/test/phpunit
